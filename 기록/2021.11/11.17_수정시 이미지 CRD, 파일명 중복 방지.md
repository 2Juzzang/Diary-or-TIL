## 수정시 이미지 파일

### 문제 1
수정시 새로 올리는 이미지의 인덱스 번호가 0부터 시작한다.
리덕스 안에 있는 파일들의 인덱스와 새로 올린 이미지 파일의 인덱스가 같아서 두개가 동시에 삭제되는 일이 발생했다.

1. 리덕스 게시글 삭제의 경우와 수정시 업로드, 삭제 게시글을 구분이 가능한가?
2. 인덱스를 0부터 시작하지 않게 할 수 있는가?

+ 해결
+ 1번이 가능할 것이라고 판단했고 map(a, i) 안에서 onClick의 인수를 인덱스 번호(i)로 줬었는데 인수를 밸류값(a)을 줘서 구분짓고 해결할 수 있었다.
```jsx
 onClick={() => {
  deleteImg(a);
  }}
```
---

### 문제 2

이 외에도 문제가 있었는데 계속 이러면 되나 저러면 되나 하면서 코드를 치다보니 더 복잡해졌다.

급할수록 돌아가라고, 먼저 현재 코드에서 되는 기능들을 정리했다.

1. 수정시 이미지 삭제 O
2. 수정시 이미지 추가 O
3. 수정시 원본 이미지 삭제 후 새로운 이미지 추가 O
4. 수정시 새로운 이미지 추가 후 원본 이미지 삭제시 새로운 이미지 추가분이 같이 삭제됨
5. 수정시 새로운 이미지 추가 후 추가 이미지 삭제 O

4번만 문제가 됨을 알았고 그 코드에서 관련된 부분들을 수정하기로 했는데 여기서
수정할 코드들은 기억할 수 있게 미리 노트에 써놓고 코드를 쳤다.

### 해결

4번을 수정하기 위해 이미지를 추가할 경우 리덕스로 이미지 파일의 URL이 업데이트되게 했는데 
여기서는 미리보기 이미지가 두개가 생기는 일이 발생해서 미리보기와 관련된 코드들인 ```props.files, props.setFiles``` 가 포함되는 부분들을 전부 주석처리해서 해결했다.

또 4번 문제의 경우 s3의 이미지 파일 삭제시 문제가 있어서 키 값을 수정해주어 해결할 수 있었다.

```jsx
업로드 부분에서 먼저 setState로 이름을 설정한 뒤
setFileName(selectImg[i].name.split('.')[0]);
setFileType(selectImg[i].name.split('.')[1]);
삭제 부분에서
 s3.deleteObject(
    {
      Bucket: 'docking',
      Key: `${fileName}.${fileType}`,
    },
그대로 사용하니 원래 있던 이미지를 삭제해도 새로 업로드한 파일이 삭제가 되는 것이 당연했다.
😂😂😂    

이 부분은
// 삭제할 파일명
const file = e.split('/')[3];
s3.deleteObject(
  {
    Bucket: 'docking',
    Key: `${file}`,
  },
이렇게 수정했다.
```
---

### 문제 3

파일 업로드시 서로 다른 사용자가 업로드한 파일의 이름이 예를 들어 a.png로 같은 경우, 이를 삭제했을 때 다른 사용자가 올린 a.png도 삭제가 된다.

### 해결 

+ 이를 방지하기위해 ```date.getTime()``` 로 밀리초를 파일명에 추가했다.  
+ 삭제도 정상적으로 되는 것을 확인했다.
---

필요없는 코드들을 삭제해주니 생각보다 코드의 양이 많이 줄어들었다.

그만큼 쓸데없는 코드를 짰던 것의 반증이라고 생각하니 슬프지만
제대로 구현이 되어 다행이다.

오늘도 느끼는 점은 컴퓨터는 잘못이 없다는 것😂

